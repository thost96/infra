---
name: Linter

permissions:
  actions: write
  checks: none # add custom pass/fail checks to the PR
  contents: write # git permissions to repo pull/push and write
  deployments: none
  issues: none # read/write to repo Issues
  packages: write # read/write to repo Packages (ghcr, gems, npm)
  pull-requests: write # read/write to repo PRs
  repository-projects: none
  security-events: none # read/write to repo Security tab API
  statuses: read # read/write to repo custom statuses and checks

on:
  push:
    branches: [main]
  pull_request:
    branches: [main]

jobs:
  super-lint:
    name: Run Super Linter
    runs-on: ubuntu-latest
    steps:
      - name: Checkout code
        uses: actions/checkout@ff7abcd0c3c05ccf6adc123a8cd1fd4fb30fb493
        with:
          fetch-depth: 0
          token: ${{ secrets.GH_TOKEN }}
          persist-credentials: true

      - name: Prettify code
        uses: creyD/prettier_action@8c18391fdc98ed0d884c6345f03975edac71b8f0
        continue-on-error: true
        with:
          prettier_options: --write **/*.{json,md,yaml,yml}
          github_token: ${{ secrets.GH_TOKEN }}
          only_changed: True

      - name: Run Super Linter
        uses: super-linter/super-linter/slim@ccb8ba06abafb17aa77cc815e121eea07a93c6ef
        continue-on-error: true
        env:
          VALIDATE_ALL_CODEBASE: true
          FIX_GITHUB_ACTIONS_ZIZMOR: true
          FIX_JSON_PRETTIER: true
          GITHUB_TOKEN: ${{ secrets.GH_TOKEN }}

      - name: Commit and push linting fixes
        # Run only on:
        # - Pull requests
        # - Not on the default branch
        if: >
          github.event_name == 'pull_request' &&
          github.ref_name != github.event.repository.default_branch
        uses: stefanzweifel/git-auto-commit-action@01d77ca6cb089da1360e540865f7d035c95aa199
        with:
          branch: ${{ github.event.pull_request.head.ref || github.head_ref || github.ref }}
          commit_message: "chore: fix linting issues"
          commit_user_name: super-linter
          commit_user_email: super-linter@super-linter.dev
